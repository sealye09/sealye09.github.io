!function(t){"use strict";class e{constructor(){this.content=null,this.toc=null,this.container=null,this.title=null,this.headings=[],this.tocItems=[],this.activeItem=null,this.observers=[],this.init()}init(){try{if(this.content=document.querySelector(".post-content"),this.toc=document.querySelector(".post-toc[data-toc]"),!this.content||!this.toc)return;if(this.container=this.toc.querySelector(".post-toc__body"),this.title=this.toc.querySelector(".post-toc__title"),!this.container)return;this.generateTOC(),this.bindEvents()}catch(t){}}generateTOC(){if(this.headings=Array.from(this.content.querySelectorAll("h1, h2, h3, h4, h5")),0===this.headings.length)return void(this.toc.style.display="none");const t=this.generateTOCHTML();this.container.innerHTML=t,this.tocItems=Array.from(this.container.querySelectorAll("a")),this.highlightCurrentItem()}generateTOCHTML(){let t="";return this.headings.forEach((e,i)=>{const s=parseInt(e.tagName.substring(1)),n=this.getHeadingText(e),o=this.generateHeadingId(e,i);t+=`\n          <a href="#${o}" class="post-toc__item post-toc__item--level-${s} ${0===i?"active":""}"\n             data-level="${s}" data-index="${i}">\n            <span class="post-toc__text">${n}</span>\n          </a>\n        `}),t}getHeadingText(t){return(t.textContent||t.innerText||"").trim()}generateHeadingId(t,e){if(t.id)return t.id;const i=this.getHeadingText(t).toLowerCase().replace(/[^\w\u4e00-\u9fa5\s-]/g,"").replace(/\s+/g,"-").trim();let s=i||`heading-${e}`,n=1;for(;document.getElementById(s);)s=`${i}-${n}`,n++;return t.id=s,s}bindEvents(){this.container.addEventListener("click",this.handleItemClick.bind(this)),window.addEventListener("scroll",this.handleScroll.bind(this),{passive:!0}),window.addEventListener("resize",this.handleResize.bind(this))}handleItemClick(t){const e=t.target.closest(".post-toc__item");if(!e)return;t.preventDefault();const i=e.getAttribute("href").substring(1),s=document.getElementById(i);s&&(this.scrollToHeading(s),this.updateHash(i),this.setActiveItem(e))}scrollToHeading(t){const e=document.querySelector(".site-header")?.offsetHeight||0,i=t.offsetTop-e-20;window.scrollTo({top:i,behavior:"smooth"})}updateHash(t){history.pushState?history.pushState(null,null,`#${t}`):location.hash=t}setActiveItem(t){this.tocItems.forEach(t=>t.classList.remove("active")),t.classList.add("active"),this.activeItem=t,this.scrollIntoView(t)}scrollIntoView(t){const e=this.container.getBoundingClientRect(),i=t.getBoundingClientRect();i.bottom>e.bottom?this.container.scrollTop+=i.bottom-e.bottom:i.top<e.top&&(this.container.scrollTop+=i.top-e.top)}handleScroll(){this.highlightCurrentItem()}highlightCurrentItem(){if(0===this.headings.length)return;const t=document.querySelector(".site-header")?.offsetHeight||0,e=window.pageYOffset+t+50;let i=-1;for(let t=this.headings.length-1;t>=0;t--)if(this.headings[t].offsetTop<=e){i=t;break}i>=0&&this.tocItems[i]&&this.setActiveItem(this.tocItems[i])}handleResize(){this.highlightCurrentItem()}addObserver(t){"function"==typeof t&&this.observers.push(t)}removeObserver(t){const e=this.observers.indexOf(t);e>-1&&this.observers.splice(e,1)}notifyObservers(t,e){this.observers.forEach(i=>{try{i(t,e)}catch(t){}})}getTOCData(){return{headings:this.headings.map((t,e)=>({index:e,level:parseInt(t.tagName.substring(1)),text:this.getHeadingText(t),id:t.id})),activeIndex:this.tocItems.indexOf(this.activeItem)}}refresh(){this.generateTOC(),this.bindEvents()}destroy(){this.container&&this.container.removeEventListener("click",this.handleItemClick),window.removeEventListener("scroll",this.handleScroll),window.removeEventListener("resize",this.handleResize),this.headings=[],this.tocItems=[],this.observers=[]}}function i(){const i=new e;t.BlogTOC={TOCManager:e,manager:i,create:()=>new e}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i()}("undefined"!=typeof window?window:global);